#pieces needed to run the associator-related stuff
include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cff"
include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
include "Geometry/CaloEventSetup/data/CaloGeometry.cfi"
include "Geometry/CommonDetUnit/data/globalTrackingGeometry.cfi"
include "TrackPropagation/SteppingHelixPropagator/data/SteppingHelixPropagatorAny.cfi"
include "TrackingTools/TrackAssociator/data/DetIdAssociatorESProducer.cff" 

include "RecoMuon/MuonIsolationProducers/data/isoDepositProducerIOBlocks.cff"

include "RecoMuon/MuonIsolationProducers/data/trackExtractorBlocks.cff"
include "RecoMuon/MuonIsolationProducers/data/caloExtractorByAssociatorBlocks.cff"
include "RecoMuon/MuonIsolationProducers/data/jetExtractorBlock.cff"
include "RecoMuon/MuonIsolationProducers/data/caloExtractorBlocks.cff"

#the default set of modules first
include "RecoMuon/MuonIsolationProducers/data/muIsoDepositCtfTk.cfi"
include "RecoMuon/MuonIsolationProducers/data/muIsoDepositJets.cfi"
include "RecoMuon/MuonIsolationProducers/data/muIsoDepositCalByAssociatorTowers.cfi"
include "RecoMuon/MuonIsolationProducers/data/muIsoDepositCalByAssociatorHits.cfi"

#now the derived ones
#muTracker and muGlobal are for backward compatibility (to be deprecated?)
module muGlobalIsoDepositCtfTk 
       = muIsoDepositCtfTk from "RecoMuon/MuonIsolationProducers/data/muIsoDepositCtfTk.cfi"
replace muGlobalIsoDepositCtfTk.IOPSet = { using MIsoDepositGlobalIOBlock }

module muTrackerIsoDepositCtfTk 
       = muIsoDepositCtfTk from "RecoMuon/MuonIsolationProducers/data/muIsoDepositCtfTk.cfi"
replace muTrackerIsoDepositCtfTk.IOPSet = { using MIsoDepositTrackerIOBlock }

module muParamGlobalIsoDepositGsTk 
       = muIsoDepositCtfTk from "RecoMuon/MuonIsolationProducers/data/muIsoDepositCtfTk.cfi"
replace muParamGlobalIsoDepositGsTk.IOPSet = { using MIsoDepositParamGlobalIOBlock }
replace muParamGlobalIsoDepositGsTk.ExtractorPSet = { using MIsoTrackExtractorGsBlock }

#muIsoDeposit maker for trackerMuons based on TrackAssociator using towers
module muGlobalIsoDepositCalByAssociatorTowers 
       = muIsoDepositCalByAssociatorTowers from "RecoMuon/MuonIsolationProducers/data/muIsoDepositCalByAssociatorTowers.cfi"
replace muGlobalIsoDepositCalByAssociatorTowers.IOPSet = { using MIsoDepositGlobalMultiIOBlock }

module muTrackerIsoDepositCalByAssociatorTowers 
       = muIsoDepositCalByAssociatorTowers from "RecoMuon/MuonIsolationProducers/data/muIsoDepositCalByAssociatorTowers.cfi"
replace muTrackerIsoDepositCalByAssociatorTowers.IOPSet = { using MIsoDepositTrackerMultiIOBlock }


#muIsoDeposit maker for globalMuons and trackerMuons based on TrackAssociator using rec-hits
module muGlobalIsoDepositCalByAssociatorHits 
       = muIsoDepositCalByAssociatorHits from "RecoMuon/MuonIsolationProducers/data/muIsoDepositCalByAssociatorHits.cfi"
replace muGlobalIsoDepositCalByAssociatorHits.IOPSet = { using MIsoDepositGlobalMultiIOBlock }

module muTrackerIsoDepositCalByAssociatorHits 
       = muIsoDepositCalByAssociatorHits from "RecoMuon/MuonIsolationProducers/data/muIsoDepositCalByAssociatorHits.cfi"
replace muTrackerIsoDepositCalByAssociatorHits.IOPSet = { using MIsoDepositTrackerMultiIOBlock }

#muIsoDeposit maker for trackerMuons based on TrackAssociator using towers
module muGlobalIsoDepositJets 
       = muIsoDepositJets from "RecoMuon/MuonIsolationProducers/data/muIsoDepositJets.cfi"
replace muGlobalIsoDepositJets.IOPSet = { using MIsoDepositGlobalIOBlock }

module muTrackerIsoDepositJets 
       = muIsoDepositJets from "RecoMuon/MuonIsolationProducers/data/muIsoDepositJets.cfi"
replace muTrackerIsoDepositJets.IOPSet = { using MIsoDepositTrackerIOBlock }

#the same but for FastSim muons
module muParamGlobalIsoDepositCalEcal = muIsoDepositCal from "RecoMuon/MuonIsolationProducers/data/muIsoDepositCal.cfi"
replace muParamGlobalIsoDepositCalEcal.IOPSet = { using MIsoDepositParamGlobalIOBlock }
replace muParamGlobalIsoDepositCalEcal.ExtractorPSet = { using MIsoCaloExtractorEcalBlock } 

module muParamGlobalIsoDepositCalHcal = muIsoDepositCal from "RecoMuon/MuonIsolationProducers/data/muIsoDepositCal.cfi"
replace muParamGlobalIsoDepositCalHcal.IOPSet = { using MIsoDepositParamGlobalIOBlock }
replace muParamGlobalIsoDepositCalHcal.ExtractorPSet = { using MIsoCaloExtractorHcalBlock }


##########################################################################
# and now sequences of the above
##########################################################################

sequence muIsoDepositsAssoc_muons = {
  muIsoDepositCalByAssociatorTowers & muIsoDepositCalByAssociatorHits
}
sequence muIsoDepositsAssoc_globalMuons = {
  muGlobalIsoDepositCalByAssociatorTowers & muGlobalIsoDepositCalByAssociatorHits
}
sequence muIsoDepositsAssoc_trackerMuons = {
  muTrackerIsoDepositCalByAssociatorTowers & muTrackerIsoDepositCalByAssociatorHits
}
#------------------------------

sequence muIsoDepositsCal_ParamGlobalMuons = {
  muParamGlobalIsoDepositCalEcal & muParamGlobalIsoDepositCalHcal
}
#------------------------------

sequence muIsoDepositsJets_muons = {
  muIsoDepositJets
}
sequence muIsoDepositsJets_globalMuons = {
  muGlobalIsoDepositJets
}
sequence muIsoDepositsJets_trackerMuons = {
  muTrackerIsoDepositJets
}

#------------------------------

sequence muIsoDepositsTk_muons = {
  muIsoDepositCtfTk
}
sequence muIsoDepositsTk_globalMuons = {
  muGlobalIsoDepositCtfTk
}
sequence muIsoDepositsTk_ParamGlobalMuons = {
  muParamGlobalIsoDepositGsTk
}
sequence muIsoDepositsTk_trackerMuons = {
  muTrackerIsoDepositCtfTk
}

#------------------------------
# "standard sequences"
sequence muIsoDeposits_muons = {
  muIsoDepositsTk_muons & muIsoDepositCalByAssociatorTowers & muIsoDepositsJets_muons
}
sequence muIsoDeposits_globalMuons = {
  muIsoDepositsTk_globalMuons & muGlobalIsoDepositCalByAssociatorTowers & muIsoDepositsJets_globalMuons
}
sequence muIsoDeposits_ParamGlobalMuons = {
  muIsoDepositsTk_ParamGlobalMuons & muIsoDepositsCal_ParamGlobalMuons
}
sequence muIsoDeposits_trackerMuons = {
  muTrackerIsoDepositCtfTk & muTrackerIsoDepositCalByAssociatorTowers & muIsoDepositsJets_trackerMuons
}
